<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EMBERWING // TECH FLIGHT</title>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#071220}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
function resize(){
  c.width = innerWidth;
  c.height = innerHeight;
}
addEventListener("resize", resize);
resize();

const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const lerp=(a,b,t)=>a+(b-a)*t;

const S = {
  t:0,
  pitch:0,
  roll:0,
  speed:520,          // MUCH faster baseline
  targetSpeed:520,
  heading:0,
  driftX:0,
  driftY:0,
  keys:new Set()
};

addEventListener("keydown",e=>S.keys.add(e.code));
addEventListener("keyup",e=>S.keys.delete(e.code));

/* ---------- SKY (kept simple, clean) ---------- */
function drawSky(){
  const g = ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,"#06101e");
  g.addColorStop(0.45,"#173b6a");
  g.addColorStop(1,"#0b1f3a");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,c.width,c.height);

  // horizon
  const y=c.height*0.55 + S.pitch*120;
  ctx.strokeStyle="rgba(220,240,255,.35)";
  ctx.lineWidth=1;
  ctx.beginPath();
  ctx.moveTo(0,y);
  ctx.lineTo(c.width,y);
  ctx.stroke();
}

/* ---------- AIRFLOW (speed cue) ---------- */
const flow=[];
for(let i=0;i<180;i++){
  flow.push({
    x:Math.random()*2-1,
    y:Math.random()*2-1,
    z:Math.random()
  });
}

function drawFlow(dt){
  const cx=c.width/2, cy=c.height/2;
  for(const f of flow){
    f.z -= dt*(S.speed/180);
    if(f.z<=0){f.z=1;f.x=Math.random()*2-1;f.y=Math.random()*2-1;}
    const p = 0.35/(f.z+0.05);
    const x = cx + f.x*c.width*p;
    const y = cy + f.y*c.height*p;
    ctx.globalAlpha = 0.15;
    ctx.strokeStyle="rgba(200,230,255,.6)";
    ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.lineTo(x, y+18*p);
    ctx.stroke();
  }
  ctx.globalAlpha=1;
}

/* ---------- AIRCRAFT (TECHNICAL, WEIGHTED) ---------- */
function drawAircraft(){
  const cx=c.width/2;
  const cy=c.height*0.62;

  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(S.roll*0.4);

  // shadow
  ctx.fillStyle="rgba(0,0,0,.45)";
  ctx.beginPath();
  ctx.ellipse(0,38,180,22,0,0,Math.PI*2);
  ctx.fill();

  // wings
  ctx.fillStyle="#e9eef3";
  ctx.beginPath();
  ctx.moveTo(-260,18);
  ctx.quadraticCurveTo(-140,-8,-28,10);
  ctx.quadraticCurveTo(0,14,28,10);
  ctx.quadraticCurveTo(140,-8,260,18);
  ctx.quadraticCurveTo(160,68,32,54);
  ctx.quadraticCurveTo(0,50,-32,54);
  ctx.quadraticCurveTo(-160,68,-260,18);
  ctx.closePath();
  ctx.fill();

  // fuselage
  ctx.fillStyle="#f5f7fa";
  ctx.beginPath();
  ctx.moveTo(0,-110);
  ctx.bezierCurveTo(-22,-110,-32,-84,-32,-56);
  ctx.lineTo(-24,90);
  ctx.bezierCurveTo(-22,120,-12,138,0,150);
  ctx.bezierCurveTo(12,138,22,120,24,90);
  ctx.lineTo(32,-56);
  ctx.bezierCurveTo(32,-84,22,-110,0,-110);
  ctx.closePath();
  ctx.fill();

  // tailplane
  ctx.fillStyle="#dfe6ee";
  ctx.beginPath();
  ctx.moveTo(-78,96);
  ctx.quadraticCurveTo(0,72,78,96);
  ctx.quadraticCurveTo(28,128,0,130);
  ctx.quadraticCurveTo(-28,128,-78,96);
  ctx.fill();

  // nose cone
  ctx.fillStyle="#cfd6de";
  ctx.beginPath();
  ctx.arc(0,-110,18,0,Math.PI*2);
  ctx.fill();

  // centerline
  ctx.strokeStyle="rgba(80,120,160,.4)";
  ctx.beginPath();
  ctx.moveTo(0,-108);
  ctx.lineTo(0,136);
  ctx.stroke();

  ctx.restore();
}

/* ---------- FLIGHT MODEL (TIGHT) ---------- */
function update(dt){
  const up=S.keys.has("ArrowUp");
  const dn=S.keys.has("ArrowDown");
  const lf=S.keys.has("ArrowLeft");
  const rt=S.keys.has("ArrowRight");

  const pIn=(up?1:0)+(dn?-1:0);
  const rIn=(rt?1:0)+(lf?-1:0);

  // Less easing, more authority
  S.pitch = lerp(S.pitch, pIn*0.28, dt*6.5);
  S.roll  = lerp(S.roll , rIn*0.45, dt*6.5);

  // Fast forward lock
  S.speed = lerp(S.speed, S.targetSpeed, dt*1.8);

  // Camera drift = minimal
  S.driftX = lerp(S.driftX, S.roll*120, dt*2.4);
  S.driftY = lerp(S.driftY,-S.pitch*160,dt*2.4);
}

/* ---------- LOOP ---------- */
let last=performance.now();
function tick(now){
  const dt=Math.min(0.033,(now-last)/1000);
  last=now;
  S.t+=dt;

  update(dt);

  ctx.clearRect(0,0,c.width,c.height);
  drawSky();
  drawFlow(dt);
  drawAircraft();

  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);
</script>
</body>
</html>
